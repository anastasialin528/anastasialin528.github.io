<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ï½œå››æœˆåäº”æ—¥ï½œ</title>
  <style>
    body { margin: 0; font-family: "Microsoft JhengHei", sans-serif; background: #fff; color: #333; line-height: 1.8; }
    header { background: #212121; padding: 1rem 2rem; color: #fff; }
    main { max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
    img { width: 100%; border-radius: 8px; margin: 1.5rem 0; }
    h1 { color: #ff6f61; font-size: 2rem; margin-bottom: 0.5rem; }
    p:empty { display: block; height: 1.0rem; }
    .date { color: #999; font-size: 0.9rem; margin-bottom: 1.5rem; }

    .back-link { display: inline-block; margin-top: 2rem; color: #ff6f61; text-decoration: none; font-weight: bold; border: 2px solid #ff6f61; padding: 0.4rem 1rem; border-radius: 25px; transition: all 0.3s ease; }
    .back-link:hover { background: #ff6f61; color: #fff; }

    .share-section { text-align: center; margin-top: 3rem; }
    .line { height: 1px; background-color: rgba(0,0,0,0.2); margin: 1rem 0; width: 100%; }
    .share-icons { display: flex; justify-content: center; align-items: center; gap: 1.5rem; margin: 1rem 0; position: relative; }
    .icon { background: none; border: none; font-size: 1.5rem; cursor: pointer; text-decoration: none; color: #333; transition: transform 0.2s ease; display: flex; justify-content: center; align-items: center; }
    .icon:hover { transform: scale(1.2); }
    .facebook-icon { font-size: 24px; font-weight: bold; color: #000; height: 40px; display: flex; justify-content: center; align-items: center; }
    #copy-link { background: none; border: none; cursor: pointer; padding: 0; width: 40px; height: 40px; }
    #copy-link img { width: 100%; height: 100%; object-fit: cover; }
    #copied-msg { position: absolute; top: 120%; font-size: 0.9rem; color: #28a745; display: none; margin-top: 5px; }

    .stats { display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; padding-left: 15px; padding-right: 15px; width: calc(100% - 30px); margin-left: auto; margin-right: auto; }
    .like-btn { background: none; border: none; font-size: 1.2rem; color: red; cursor: pointer; display: flex; align-items: center; }
    .like-btn:hover { color: #e04848; }
    .like-btn span { margin-left: 5px; }
    .like-btn.is-liked { opacity: .6; cursor: default; pointer-events: none; }
  </style>
</head>
<body>
  <header><h1>ï½œå››æœˆåäº”æ—¥ï½œ</h1></header>
  <main>
    <div class="date">2025å¹´4æœˆ15æ—¥</div>

    <img src="images/è‹”è˜š.jpg" alt="ï½œå››æœˆåäº”æ—¥ï½œ">
    <p>ä»Šå¤©ç¿»ä»¥å‰çš„ç¶²èªŒï¼Œçœ‹è¦‹ä¸€ç¯‡å¹¾å¹´å‰è »æœ‰æ„Ÿè¦ºçš„è©©ï¼Œä¹Ÿæƒ³èµ·éå¾€æ›¾ç¶“çš„å…¨å¿ƒå…¨æ„ã€‚èµ°éçš„è·¯ï¼Œé›–ç„¶éå»ï¼Œå»ä¹Ÿæ˜¯é“ç¾éº—çš„é¢¨æ™¯ï¼Œç¾å¥½çš„å›æ†¶ã€‚</p>
    <p>æ„›éä¸€äº›äºº</p>
    <p>æˆç‚ºä»–å€‘çš„å½±å­</p>
    <p>è¢«ä¸€äº›äººæ„›é</p>
    <p>å½±å­ç•™çµ¦äº†ä»–å€‘</p>
    <p></p>
    <p>å¾Œä¾†æˆ‘å°±ä¸€ç›´åœ¨é€™</p>
    <p>åƒæ˜¯å„æœ‰å„çš„æ—…ç¨‹</p>
    <p>è€Œæˆ‘æ˜¯è¿·è·¯çš„å­©å­ä¸çŸ¥æ‰€æª</p>
    <p>å°‡ä¸€åˆ‡æ€ªç½ªæ–¼ä¸Ÿå¤±æˆ‘çš„äºº</p>
    <p></p>
    <p>å¶çˆ¾åä¸Šè»Š</p>
    <p>å»çœ‹çœ‹æ›¾è½èªªé</p>
    <p>è€Œæˆ‘æœªèƒ½æŠµé”</p>
    <p>ä»–çš„å®¶é„‰</p>
    <p></p>
    <p>ä¸çŸ¥é“é‚£äººæ˜¯å¦å®‰å¥½</p>
    <p>å‚·é‚„æœƒéš±éš±ä½œç—›å—ã€‚</p>
    <p></p>â € 
    <p>ç”¨ä¸€å€‹å¥è™ŸçµæŸ</p>
    <p>å› ç‚ºç­”æ¡ˆæ˜¯ä»€éº¼ä¸¦ä¸é‡è¦</p>
    <p>ç¾åœ¨çš„æˆ‘ä»€éº¼ä¹Ÿç„¡æ³•å½Œè£œ</p>
    <p></p>â € 
    <p>ä½†æ˜¯å•é¡Œæœ¬èº«å¾ˆé‡è¦</p>
    <p>åƒä¸€é¢éš¨èº«çš„é¡å­</p>
    <p>æˆ–è€…ä¸€å€‹ç¸ˆç¹çš„å¹½éˆ</p>
    <p>åœ¨æ¯ä¸€å€‹å¤¢é†’æ™‚</p>
    <p>æé†’æˆ‘</p>
    <p>ç•¶ä¸‹åšçš„æ¯ä¸€å€‹æ±ºå®š</p>
    <p>ä¸ä¸€å®šæ¸…é†’ã€‚</p>
   â €<p></p>  
    <p>è¬è¬ä½ çœ‹è¦‹æˆ‘</p>
    <p>é‚£æ˜¯æˆ‘çœ‹ä¸è¦‹çš„æ¨£å­</p>
    <p>è¬è¬ä½ æ•™æœƒæˆ‘æ„›çš„æ–¹å¼</p>
    <p>ä¸åªä¸€ç¨®</p>
    <p>è‹¥å¾—åˆ°çš„ä¸å¦‚é æœŸ</p>
    <p>ä¸¦ä¸ä»£è¡¨é‚£ä¸æ˜¯å…¨å¿ƒå…¨æ„</p>
    <p>è¬è¬ä½ çš„å…‰ä½ çš„é¢¨</p>
    <p>ä½ çš„é›¨</p>
    <p></p>â € 
    <p>è¬è¬ä½ æ›¾æ„›é</p>
    <p>å„˜ç®¡æ˜¯é€™æ¨£çš„æˆ‘ã€‚</p>
    <p></p>
    <p>-æè±ªã€Šç˜¦éª¨å¶™å³‹çš„æ„›ã€‹</p>
    <p></p>
    <p></p>
    <p></p>
    <p>é€™é€±æœƒæ˜¯å……æ»¿è£½ä½œå„€è¡¨æ¿çš„æ—¥å­ï¼ŒæŒçºŒåŠ ç­ã€æŒçºŒåŸ‹åœ¨å„ç¨®é…è‰²ã€‚</p>
    <p>å¥½ä¸å®¹æ˜“å„€è¡¨æ¿å¾ä¸€é–‹å§‹çš„å¹¾å¼µçµ±è¨ˆæ•¸æ“šï¼Œç¶“éä¸‰ç•ªå…©æ¬¡ä¸‹èªæ³•çœ‹è³‡æ–™ä¸­ç‰¹æ®Šçš„æ¨£æ…‹ï¼Œç„¶å¾Œå¾å„ç¨®è¦–è¦ºåŒ–åœ–è¡¨ä¸­é¸æ“‡é©åˆçš„åœ–ä¾†å‘ˆç¾ï¼ˆéç¨‹ä¸­é‚„æœ‰å¾ˆå¤šä¸å ªå›é¦–çš„ç—›æ‰£éç¨‹ï¼Œè…¦ç´°èƒæ­»å…‰å…‰ï¼‰ã€‚</p>
    <p>ç›´åˆ°æ˜¨å¤©ï¼ŒåŸºæœ¬åœ–å½¢å¤§è‡´å®šæ¡ˆï¼Œä»Šå¤©æ‰èƒ½è¿ä¾†ã€Œé…è‰²åœ°ç„ã€çš„å¤§é–€ã€‚è©±èªªï¼Œé€™å¥½åƒæ˜¯æˆ‘äººç”Ÿä¸­ç¬¬ä¸€æ¬¡é…è‰²é…çš„é€™éº¼èªçœŸï¼Œä½†å…¶å¯¦èªªä¾†ä¹Ÿæ˜¯ä¸å¾—å·²ï¼Œå› ç‚ºå¾ä¸€é–‹å§‹çš„å…¨ç™½ç•«é¢åˆ°æœ€å¾Œè®Šæˆç²¾ç¾å„€è¡¨æ¿ï¼Œå„å€‹å€å¡Šéƒ½èƒ½è®“ä½ è‡ªè¨‚è‰²å½©â€¦.ã€‚è‡ªç”±åº¦å¤ªå¤§æœ‰æ™‚å€™ä¹Ÿæ˜¯ä¸€ç¨®ç´¯å•Šâ‹¯ã€‚å„ç¨®ç´°ç¯€èª¿æ•´+è¨­å®šã€‚ç¬¬ä¸€æ¬¡é…è‰²åˆ°å¥½æƒ³åğŸ¤ª</p>
    <p>å‰©ä¸‹ä¸€å¼µå„€è¡¨æ¿è‰²å½©å°šæœªå®šæ¡ˆï¼Œå¸Œæœ›æ˜å¤©èƒ½å¾é…è‰²åœ°ç„è„«èº«ã€‚ç„¶å¾Œï¼Œå¿«å»é¢å°åœ¨è³‡æ–™éš”é›¢å®¤ç­‰å¾…æˆ‘å»æ¸…æ•´çš„ä¸€å †è³‡æ–™å€‘ã€‚</p>
    <p>æœŸå¾…é€±æœ«çš„ä¸‹æ°´æ—¥ï¼Œå¸Œæœ›æ¥ä¸‹ä¾†æ¯å€‹é€±æœ«éƒ½èƒ½æ³¡åœ¨æ°´è£¡ã€‚</p>
    <p>ï¼ˆåœ–ï¼‰è‹”è˜šï¼Œåœ¨å»ºåœ‹èŠ±å¸‚è²·çš„æ–°æ¤ç‰©æœ‹å‹ã€‚</p>
    <p>é€™å¹¾å¤©å›åˆ°å®¶æ‘¸æ‘¸å®ƒå°±è¦ºå¾—è¢«æ²»ç™’äº†ï¼ŒçœŸå¯æ„›ã€‚</p>

    <a class="back-link" href="index.html">â† å›åˆ°é¦–é </a>

    <!-- åˆ†äº«åŠŸèƒ½ -->
    <div class="share-section">
      <div class="line"></div>
      <div class="share-icons">
        <a class="icon facebook-icon" id="fb-share" href="#" target="_blank" rel="noopener noreferrer" title="åˆ†äº«åˆ° Facebook">f</a>
        <button class="icon" id="copy-link" title="è¤‡è£½é€£çµ">
          <img src="images/share.jpg" alt="è¤‡è£½é€£çµ">
        </button>
        <span id="copied-msg">Link Copied!</span>
      </div>
      <div class="line"></div>
    </div>

    <!-- è§€çœ‹èˆ‡æŒ‰è®š -->
    <div class="stats">
      <div class="view"><span id="post-views">0</span> views</div>
      <div class="like">
        <button class="like-btn" id="post-like-btn">â™¡ <span id="post-likes">0</span></button>
      </div>
    </div>
  </main>

  <!-- å…ˆè¼‰å…¥å…±ç”¨ API è¨­å®šæª”ï¼ˆæ”¾åœ¨ä»»ä½•ç”¨åˆ° API_URL çš„ <script> ä¹‹å‰ï¼‰ -->
  <script src="./api.js?v=1"></script>

  <!-- å¾Œç«¯ API èˆ‡å…±ç”¨å·¥å…· -->
  <script>
    const API_URL = window.API_URL; // ç”± api.js æä¾›

    // â€”â€” GET å‘¼å«ï¼ˆé¿å…é æª¢ï¼‰â€”â€”
    async function api(params){
      const url = API_URL + '?' + new URLSearchParams(params).toString();
      const r = await fetch(url, { cache: 'no-store' });
      return r.json();
    }
    const getStats = (id) => api({ action:'get', id });
    const addView  = (id) => api({ action:'addView', id });
    const likeAPI  = (id) => api({ action:'like', id });

    // æœ¬æ©Ÿ liked mapï¼ˆèˆ‡é¦–é å…±ç”¨ï¼‰
    const LIKE_KEY = 'blog_liked_map';
    function loadLiked(){ try { return JSON.parse(localStorage.getItem(LIKE_KEY) || '{}'); } catch { return {}; } }
    function saveLiked(m){ localStorage.setItem(LIKE_KEY, JSON.stringify(m)); }
    function isLiked(id){ return !!loadLiked()[id]; }
    function setLiked(id,v){ const m = loadLiked(); m[id] = !!v; saveLiked(m); }

    // æ¸²æŸ“æ„›å¿ƒ
    function renderHeart(btnEl, id, likeCount, likesSpanId){
      const liked = isLiked(id);
      btnEl.innerHTML = `${liked ? 'â¤ï¸' : 'â™¡'} <span id="${likesSpanId}">${likeCount ?? 0}</span>`;
      btnEl.classList.toggle('is-liked', liked);
      btnEl.disabled = liked;
    }

    // æ–‡ç«  idï¼ˆç”¨æª”åï¼‰
    function getPostIdFromLocation(){
      const last = location.pathname.split('/').pop();
      return decodeURIComponent(last || 'index.html');
    }

    // è·¨åˆ†é åŒæ­¥ï¼ˆåˆ¥é æŒ‰è®šæ™‚ï¼Œé€™é æ›´æ–°æ¨£å¼ï¼‰
    window.addEventListener('storage', (e) => {
      if (e.key !== LIKE_KEY) return;
      syncCurrentHeart();
    });
  </script>

  <!-- å…§é é‚è¼¯ -->
  <script>
    // åˆ†äº«ï¼šå‹•æ…‹å¡ç›®å‰ç¶²å€
    const fbA = document.getElementById('fb-share');
    if (fbA) fbA.href = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(location.href);
    const copyBtn = document.getElementById("copy-link");
    if (copyBtn) {
      copyBtn.addEventListener("click", () => {
        navigator.clipboard.writeText(location.href).then(() => {
          const msg = document.getElementById("copied-msg");
          if (!msg) return;
          msg.style.display = "inline";
          setTimeout(() => { msg.style.display = "none"; }, 2000);
        });
      });
    }

    // è®“ storage äº‹ä»¶èƒ½åŒæ­¥é€™é çš„æ„›å¿ƒ
    function syncCurrentHeart(){
      const id = getPostIdFromLocation();
      const btn = document.getElementById('post-like-btn');
      const likesSpan = document.getElementById('post-likes');
      if (btn && likesSpan) {
        const currentLikes = parseInt(likesSpan.textContent || '0', 10);
        renderHeart(btn, id, currentLikes, 'post-likes');
      }
    }

    (async () => {
      const POST_ID = getPostIdFromLocation();

      // é–‹é  +1 è§€çœ‹ï¼ˆå°±ç®—å¤±æ•—ä¹Ÿä¸ä¸­æ–·ï¼‰
      try { await addView(POST_ID); } catch(e){ console.warn('addView fail', e); }

      // å–å¾—æœ€æ–°æ•¸å­—ï¼ˆå¤±æ•—çµ¦ 0ï¼‰
      let views = 0, likes = 0;
      try {
        const s = await getStats(POST_ID);
        views = (s && s.ok && s.views != null) ? s.views : 0;
        likes = (s && s.ok && s.likes != null) ? s.likes : 0;
      } catch(e) {
        console.warn('getStats fail', e);
      }

      // ç•«åˆ°é é¢
      const viewEl  = document.getElementById('post-views');
      const likesEl = document.getElementById('post-likes');
      const btn     = document.getElementById('post-like-btn');
      if (viewEl)  viewEl.textContent = views;
      if (likesEl) likesEl.textContent = likes;
      if (btn)     renderHeart(btn, POST_ID, likes, 'post-likes');

      // ç¶å®šæ„›å¿ƒ
      if (btn) {
        btn.addEventListener('click', async (e) => {
          e.preventDefault();
          if (isLiked(POST_ID)) return;

          btn.disabled = true;
          const curLikes = parseInt(document.getElementById('post-likes')?.textContent || '0', 10);

          // æ¨‚è§€ +1
          renderHeart(btn, POST_ID, curLikes + 1, 'post-likes');

          try {
            const res = await likeAPI(POST_ID);
            if (res && res.ok) {
              setLiked(POST_ID, true);
              renderHeart(btn, POST_ID, res.likes ?? (curLikes + 1), 'post-likes');
            } else {
              renderHeart(btn, POST_ID, curLikes, 'post-likes'); // å¾©åŸ
              alert('æŒ‰è®šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
              btn.disabled = false;
            }
          } catch (err) {
            renderHeart(btn, POST_ID, curLikes, 'post-likes'); // å¾©åŸ
            alert('æŒ‰è®šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
            btn.disabled = false;
          }
        });
      }
    })();
  </script>
</body>
</html>
