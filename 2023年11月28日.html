<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>｜日本東北自助旅行-みやぎけん鳴子峽｜</title>
  <style>
    body { 
      margin: 0; 
      font-family: "Microsoft JhengHei", sans-serif; 
      background: #fff; 
      color: #333; 
      line-height: 1.8; 
    }
    header { 
      background: #212121; 
      padding: 1rem 2rem; 
      color: #fff; 
    }
    main { 
      max-width: 800px; 
      margin: 2rem auto; 
      padding: 0 1rem; 
    }
    img { 
      width: 100%; 
      border-radius: 8px; 
      margin: 1.5rem 0; 
    }
    h1 { 
      color: #ff6f61; 
      font-size: 2rem; 
      margin-bottom: 0.5rem;
    }
    p:empty { 
      display: block; 
      height: 1.0rem; 
    }
    .date { 
      color: #999; 
      font-size: 0.9rem; 
      margin-bottom: 1.5rem; 
    }

    .back-link { 
      display: inline-block; 
      margin-top: 2rem; 
      color: #ff6f61; 
      text-decoration: none;
      font-weight: bold;
      border: 2px solid #ff6f61; 
      padding: 0.4rem 1rem; 
      border-radius: 25px; 
      transition: all 0.3s ease; 
    }
    .back-link:hover { 
      background: #ff6f61; 
      color: #fff; 
    }

    .share-section { 
      text-align: center; 
      margin-top: 3rem; 
    }
    .line { 
      height: 1px; 
      background-color: rgba(0,0,0,0.2); 
      margin: 1rem 0; 
      width: 100%; 
    }
    .share-icons { 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      gap: 1.5rem; 
      margin: 1rem 0; 
      position: relative; 
    }
    .icon { 
      background: none; 
      border: none; 
      font-size: 1.5rem; 
      cursor: pointer; 
      text-decoration: none; 
      color: #333; 
      transition: transform 0.2s ease; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
    }
    .icon:hover { 
      transform: scale(1.2); 
    }
    .facebook-icon { 
      font-size: 24px; 
      font-weight: bold; 
      color: #000; 
      height: 40px; 
      display: flex; 
      justify-content: center; 
      align-items: center;
    }
    #copy-link { 
      background: none; 
      border: none; 
      cursor: pointer; 
      padding: 0; 
      width: 40px; 
      height: 40px; 
    }
    #copy-link img { 
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
    }
    #copied-msg { 
      position: absolute; 
      top: 120%; 
      font-size: 0.9rem; 
      color: #28a745; 
      display: none; 
      margin-top: 5px; 
    }

    .stats { 
      display: flex; 
      justify-content: space-between;
      align-items: center; 
      margin-top: 1rem;
      padding-left: 15px; 
      padding-right: 15px; 
      width: calc(100% - 30px); 
      margin-left: auto; 
      margin-right: auto; 
    }
    .like-btn { 
      background: none; 
      border: none; 
      font-size: 1.2rem; 
      color: red; 
      cursor: pointer; 
      display: flex; 
      align-items: center; 
    }
    .like-btn:hover { 
      color: #e04848; 
    }
    .like-btn span { 
      margin-left: 5px; 
    }
    .like-btn.is-liked { 
      opacity: .6; cursor: default; 
      pointer-events: none; 
    }
  </style>
</head>
<body>
  <header><h1>｜日本東北自助旅行-みやぎけん鳴子峽｜</h1></header>
  <main>
    <div class="date">2023年11月28日</div>

    <img src="images/DSC08289.jpg" alt="｜日本東北自助旅行-みやぎけん鳴子峽｜">

    <p>11/10旅行第二天6:50左右，我們從Hotel Monte Hermana Sendai步行到附近的「仙台站」搭乘7:06發車的Yamabiko號，沿著東北·北海道幹線到「谷川站」，接著從「谷川站」轉乘陸羽東線前往「鳴子溫泉站」。</p>

    <p>在台灣預定車票時發現從谷川轉車的時間只有七分鐘。7:20到達谷川站之後，往鳴子溫泉的火車7:27就發車了，若七分鐘內趕不上這班火車，則需等到9:20。安排行程時還不放心查了谷川站內平面圖，看見在來線月台就在新幹線的旁邊，我們全程只需刷JR東日本東北周遊券的那張票即可，無需在車站內花費太多時間，這才稍微安心，有自信那七分鐘應該足夠我們使用。實際跑過一次確定這七分鐘確實搓搓有餘，若有需要的旅者無須太過焦慮。</p>

    <img src="images/DSC08292.jpg" alt="附近地圖">

    <p>不過我看錯車內的到站站名提示，看見「鳴子」兩個字就匆忙下車，結果在「鳴子溫泉」的前一站「鳴子御殿湯」就下車了😂。走出車站發現是個無人車站，也可能是因為太早到了，附近僅有一間賣名產的小店開著。沒吃早餐太飢餓的我們不小心買了一盒需要配飯才能下嚥的海苔捲，後來還因為太鹹吃不完😂。</p>


    <p>其實那個海苔捲味道很好，海苔酥脆，裡頭包裹著類似梅子之類酸鹹的東西，若是配稀飯肯定對味。另外也要謝謝好心的店員幫我們打電話叫計程車使我們順利到達鳴子峽(當時已過了紅葉季，巡迴巴士已停駛，僅能搭計程車前往)。</p>

     <img src="images/DSC0E8288.jpg" alt="遊客服務中心">

     <p>自助旅行得靠自己的力量前往想到達的地方，途中經常出現的小插曲都讓整段旅行更加豐富多彩。即便稍微辛苦了一些，可是和日本孩子一起追電車、體驗窗外6度但熱氣從雙腳後面無止盡冒出的溫暖列車、過程中得到當地人各種幫助的欣慰，深刻融入當地生活的感覺和成就感都會讓這些困難變成更甜美且與眾不同的旅行記憶。</p>

    <img src="images/DSC0E8279.jpg" alt="鳴子峽">
    <img src="images/DSC0E8283.jpg" alt="鳴子峽">


    <p>鳴子峽的楓葉70%已經凋零，峽谷的風景還是讓我們驚艷，若是在楓葉見傾時過來肯定更使人難以忘懷吧！</p>

    <img src="images/DSC0E8282.jpg" alt="鳴子峽步道的楓葉">

    <p>下去鳴子峽谷的步道看似陡峭，全程都有石階及欄杆，小心行走的話還是算安全的。單程二十分鐘美景不間斷，天氣晴朗的時候十分推薦下去走走，欣賞瀑布、峽谷、楓葉的三重奏。</p>


    <a class="back-link" href="index.html">← 回到首頁</a>

    <!-- 分享功能 -->
    <div class="share-section">
      <div class="line"></div>
      <div class="share-icons">
        <a class="icon facebook-icon" id="fb-share"
           href="https://www.facebook.com/sharer/sharer.php?u=https://yourwebsite.com/post.html"
           target="_blank" rel="noopener noreferrer" title="分享到 Facebook">f</a>
        <button class="icon" id="copy-link" title="複製連結">
          <img src="images/share.jpg" alt="複製連結">
        </button>
        <span id="copied-msg">Link Copied!</span>
      </div>
      <div class="line"></div>
    </div>

    <!-- 觀看與按讚 -->
    <div class="stats">
      <div class="view"><span id="post-views">0</span> views</div>
      <div class="like">
        <button class="like-btn" id="post-like-btn">♡ <span id="post-likes">0</span></button>
      </div>
    </div>
  </main>

  <!-- 後端 API 與共用工具 -->
  <script>
    // 與首頁一致
    const API_URL = 'https://script.google.com/macros/s/AKfycbyalOSHqfhnv6jG0q_MZ07cISdssvny0rqjFtyBGRlDD-wDBB8hjK9DTBahlFqB54Hc/exec';
    async function api(params) {
      const url = API_URL + '?' + new URLSearchParams(params).toString();
      try {
        const r = await fetch(url, { cache: 'no-store' });
        return await r.json();
      } catch (e) {
        console.error('API error:', e);
        return { ok:false, error: String(e) };
      }
    }
    const getStats = (id) => api({ action:'get', id });
    const addView  = (id) => api({ action:'addView', id });
    const likeAPI  = (id) => api({ action:'like', id });
    const unlikeAPI= (id) => api({ action:'unlike', id });

    // 本機 liked map（與首頁共用同一 key）
    const LIKE_KEY = 'blog_liked_map';
    function loadLiked(){ try{return JSON.parse(localStorage.getItem(LIKE_KEY)||'{}')}catch{return{}} }
    function saveLiked(m){ localStorage.setItem(LIKE_KEY, JSON.stringify(m)); }
    function isLiked(id){ return !!loadLiked()[id]; }
    function setLiked(id,val){ const m=loadLiked(); m[id]=!!val; saveLiked(m); }

    function renderHeart(btnEl, id, likeCount, likesSpanId){
      const liked = isLiked(id);
      btnEl.innerHTML = `${liked ? '❤️' : '♡'} <span id="${likesSpanId}">${likeCount ?? 0}</span>`;
      btnEl.classList.toggle('is-liked', liked);
      btnEl.disabled = liked;
    }

    function getPostIdFromLocation(){
      const last = location.pathname.split('/').pop();
      return decodeURIComponent(last || 'index.html');
    }

    // storage 同步（當其他頁按了讚）
    window.addEventListener('storage', (e) => {
      if (e.key !== LIKE_KEY) return;
      if (typeof syncCurrentHeart === 'function') syncCurrentHeart();
    });
  </script>

  <!-- 內頁邏輯 -->
  <script>
    // 分享連結
    const fbA = document.getElementById('fb-share');
    if (fbA) fbA.href = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(location.href);
    const copyBtn = document.getElementById("copy-link");
    if (copyBtn) {
      copyBtn.addEventListener("click", function () {
        navigator.clipboard.writeText(window.location.href).then(() => {
          const msg = document.getElementById("copied-msg");
          if (!msg) return;
          msg.style.display = "inline";
          setTimeout(() => { msg.style.display = "none"; }, 2000);
        });
      });
    }

    // 讓 storage 事件能同步這頁的愛心
    function syncCurrentHeart(){
      const id = getPostIdFromLocation();
      const btn = document.getElementById('post-like-btn');
      const likesSpan = document.getElementById('post-likes');
      if (btn && likesSpan) {
        const currentLikes = parseInt(likesSpan.textContent || '0', 10);
        renderHeart(btn, id, currentLikes, 'post-likes');
      }
    }

    (async () => {
      const POST_ID = getPostIdFromLocation();

      // 開頁 +1 觀看
      await addView(POST_ID);

      // 取得最新數字
      const statsResp = await getStats(POST_ID);
      const views = (statsResp && statsResp.ok && statsResp.views != null) ? statsResp.views : 0;
      const likes = (statsResp && statsResp.ok && statsResp.likes != null) ? statsResp.likes : 0;

      const viewEl = document.getElementById('post-views');
      const likesEl = document.getElementById('post-likes');
      const btn = document.getElementById('post-like-btn');

      if (viewEl) viewEl.textContent = views;
      if (likesEl) likesEl.textContent = likes;
      if (btn) renderHeart(btn, POST_ID, likes, 'post-likes');

      // 愛心：同一使用者不可重複按
      if (btn) {
        btn.addEventListener('click', async (e) => {
          e.preventDefault();
          if (isLiked(POST_ID)) return;

          btn.disabled = true;
          let curLikes = parseInt(document.getElementById('post-likes')?.textContent || '0', 10);

          // 樂觀 +1
          renderHeart(btn, POST_ID, curLikes + 1, 'post-likes');

          const res = await likeAPI(POST_ID);
          if (res && res.ok) {
            setLiked(POST_ID, true);
            renderHeart(btn, POST_ID, res.likes ?? (curLikes + 1), 'post-likes');
          } else {
            // 失敗復原
            renderHeart(btn, POST_ID, curLikes, 'post-likes');
            alert('按讚失敗，請稍後再試。');
            btn.disabled = false;
          }
        });
      }
    })();
  </script>
</body>
</html>

