<!DOCTYPE html> <!-- HTML5 æ–‡ä»¶å®£å‘Š -->
<html lang="zh-Hant"> <!-- è¨­å®šé é¢èªç³»ç‚ºç¹é«”ä¸­æ–‡ -->
<head>
  <meta charset="UTF-8"> <!-- è¨­å®šå­—ç¬¦ç·¨ç¢¼ç‚º UTF-8ï¼Œé¿å…äº‚ç¢¼ -->
  <meta name="viewport" content="width=device-width,initial-scale=1"> <!-- è¨­å®šéŸ¿æ‡‰å¼è¨­è¨ˆï¼Œé©æ‡‰ä¸åŒè£ç½®è¢å¹•å¤§å° -->
  <title>ï½œæ¯›è¶Šå¯ºçš„æ¥“æ¨¹ï½œ</title> <!-- è¨­å®šé é¢æ¨™é¡Œ -->
  <style>
    /* ====== å…¨ç«™åŸºæœ¬æ¨£å¼ ====== */
    body { 
      margin:0;  /* ç§»é™¤é é¢å¤–é‚Šè· */
      font-family:"Microsoft JhengHei",sans-serif;  /* è¨­å®šå­—å‹ */
      background:#fff;  /* è¨­å®šé é¢èƒŒæ™¯é¡è‰²ç‚ºç™½è‰² */
      color:#333;  /* è¨­å®šæ–‡å­—é¡è‰²ç‚ºæ·±ç°è‰² */
      line-height:1.8;  /* è¨­å®šè¡Œé«˜ç‚º1.8ï¼Œå¢åŠ è¡Œé–“è· */
    }

    /* ====== é é¦–æ¨£å¼ ====== */
    header { 
      background:#212121;  /* è¨­å®šèƒŒæ™¯ç‚ºæ·±ç°è‰² */
      padding:1rem 2rem;  /* è¨­å®šå…§é‚Šè· */
      color:#fff;  /* è¨­å®šæ–‡å­—é¡è‰²ç‚ºç™½è‰² */
    }

    /* ====== ä¸»å…§å®¹æ¨£å¼ ====== */
    main { 
      max-width:800px;  /* è¨­å®šä¸»å…§å®¹å€å¡Šæœ€å¤§å¯¬åº¦ */
      margin:2rem auto;  /* è¨­å®šä¸Šä¸‹é–“è·ç‚º2remï¼Œä¸¦ç½®ä¸­ */
      padding:0 1rem;  /* è¨­å®šå·¦å³å…§é‚Šè· */
    }

    /* ====== åœ–ç‰‡æ¨£å¼ ====== */
    img { 
      width:100%;  /* è¨­å®šåœ–ç‰‡å¯¬åº¦ç‚º100% */
      border-radius:8px;  /* è¨­å®šåœ–ç‰‡åœ“è§’ */
      margin:1.5rem 0;  /* è¨­å®šåœ–ç‰‡ä¸Šä¸‹é–“è· */
    }

    /* ====== æ¨™é¡Œæ¨£å¼ ====== */
    h1 { 
      color:#ff6f61;  /* è¨­å®šæ¨™é¡Œæ–‡å­—é¡è‰²ç‚ºç²‰ç´…è‰² */
      font-size:2rem;  /* è¨­å®šæ¨™é¡Œå­—é«”å¤§å°ç‚º2rem */
      margin-bottom:.5rem;  /* è¨­å®šæ¨™é¡Œåº•éƒ¨é–“è· */
    }

    /* ====== è®“ç©ºæ®µè½é¡¯ç¤ºç©ºç™½çš„æ¨£å¼ ====== */
    p:empty { 
      display:block;  /* è¨­å®šç©ºæ®µè½é¡¯ç¤ºç‚ºå€å¡Š */
      height:1rem;  /* è¨­å®šé«˜åº¦ç‚º1rem */
    }

    /* ====== æ—¥æœŸæ¨£å¼ ====== */
    .date { 
      color:#999;  /* è¨­å®šæ—¥æœŸæ–‡å­—é¡è‰²ç‚ºç°è‰² */
      font-size:.9rem;  /* è¨­å®šå­—é«”å¤§å°ç‚º0.9rem */
      margin-bottom:1.5rem;  /* è¨­å®šåº•éƒ¨é–“è· */
    }

    /* ====== è¿”å›é¦–é æŒ‰éˆ•æ¨£å¼ ====== */
    .back-link { 
      display:inline-block;  /* è¨­å®šç‚ºå…§è¯å¡Šå…ƒç´  */
      margin-top:2rem;  /* è¨­å®šä¸Šæ–¹é–“è· */
      color:#ff6f61;  /* è¨­å®šæ–‡å­—é¡è‰²ç‚ºç²‰ç´…è‰² */
      text-decoration:none;  /* ç§»é™¤æ–‡å­—åº•ç·š */
      font-weight:bold;  /* è¨­å®šæ–‡å­—ç‚ºç²—é«” */
      border:2px solid #ff6f61;  /* è¨­å®šé‚Šæ¡†ç‚ºç²‰ç´…è‰² */
      padding:.4rem 1rem;  /* è¨­å®šå…§é‚Šè· */
      border-radius:25px;  /* è¨­å®šåœ“è§’ */
      transition:.3s;  /* è¨­å®šéæ¸¡æ™‚é–“ */
    }

    .back-link:hover { 
      background:#ff6f61;  /* è¨­å®šæ»‘é¼ æ‡¸åœæ™‚èƒŒæ™¯é¡è‰²ç‚ºç²‰ç´…è‰² */
      color:#fff;  /* è¨­å®šæ»‘é¼ æ‡¸åœæ™‚æ–‡å­—é¡è‰²ç‚ºç™½è‰² */
    }

    /* ====== åˆ†äº«å€å¡Šæ¨£å¼ ====== */
    .share-section { 
      text-align:center;  /* è¨­å®šæ–‡å­—ç½®ä¸­ */
      margin-top:3rem;  /* è¨­å®šä¸Šæ–¹é–“è· */
    }

    .line { 
      height:1px;  /* è¨­å®šç·šæ¢é«˜åº¦ç‚º1px */
      background-color:rgba(0,0,0,.2);  /* è¨­å®šç·šæ¢é¡è‰²ç‚ºæ·¡ç°è‰² */
      margin:1rem 0;  /* è¨­å®šä¸Šä¸‹é–“è· */
      width:100%;  /* è¨­å®šç·šæ¢å¯¬åº¦ç‚º100% */
    }

    .share-icons { 
      display:flex;  /* è¨­å®šç‚ºå½ˆæ€§å®¹å™¨ */
      justify-content:center;  /* è¨­å®šå®¹å™¨å…§çš„é …ç›®å±…ä¸­å°é½Š */
      align-items:center;  /* è¨­å®šå®¹å™¨å…§çš„é …ç›®å‚ç›´å±…ä¸­ */
      gap:1.5rem;  /* è¨­å®šé …ç›®é–“è· */
      margin:1rem 0;  /* è¨­å®šä¸Šä¸‹é–“è· */
      position:relative;  /* è¨­å®šä½ç½®ç‚ºç›¸å°å®šä½ */
    }

    .icon { 
      background:none;  /* è¨­å®šèƒŒæ™¯ç‚ºé€æ˜ */
      border:none;  /* ç§»é™¤é‚Šæ¡† */
      font-size:1.5rem;  /* è¨­å®šå­—é«”å¤§å°ç‚º1.5rem */
      cursor:pointer;  /* è¨­å®šæ»‘é¼ æ¨£å¼ç‚ºæŒ‡æ¨™ */
      text-decoration:none;  /* ç§»é™¤æ–‡å­—åº•ç·š */
      color:#333;  /* è¨­å®šé¡è‰²ç‚ºæ·±ç°è‰² */
      transition:transform .2s;  /* è¨­å®šéæ¸¡æ•ˆæœ */
      display:flex;  /* è¨­å®šç‚ºå½ˆæ€§å®¹å™¨ */
      justify-content:center;  /* è¨­å®šå®¹å™¨å…§çš„é …ç›®å±…ä¸­å°é½Š */
      align-items:center;  /* è¨­å®šå®¹å™¨å…§çš„é …ç›®å‚ç›´å±…ä¸­ */
    }

    .icon:hover { 
      transform:scale(1.2);  /* è¨­å®šæ»‘é¼ æ‡¸åœæ™‚ï¼ŒæŒ‰éˆ•æ”¾å¤§ */
    }

    .facebook-icon { 
      font-size:24px;  /* è¨­å®šå­—é«”å¤§å° */
      font-weight:bold;  /* è¨­å®šå­—é«”ç‚ºç²—é«” */
      color:#000;  /* è¨­å®šé¡è‰²ç‚ºé»‘è‰² */
      height:40px;  /* è¨­å®šé«˜åº¦ */
      display:flex;  /* è¨­å®šç‚ºå½ˆæ€§å®¹å™¨ */
      justify-content:center;  /* è¨­å®šå®¹å™¨å…§çš„é …ç›®å±…ä¸­å°é½Š */
      align-items:center;  /* è¨­å®šå®¹å™¨å…§çš„é …ç›®å‚ç›´å±…ä¸­ */
    }

    #copy-link { 
      background:none;  /* è¨­å®šèƒŒæ™¯ç‚ºé€æ˜ */
      border:none;  /* ç§»é™¤é‚Šæ¡† */
      cursor:pointer;  /* è¨­å®šæ»‘é¼ æ¨£å¼ç‚ºæŒ‡æ¨™ */
      padding:0;  /* ç§»é™¤å…§é‚Šè· */
      width:40px;  /* è¨­å®šå¯¬åº¦ */
      height:40px;  /* è¨­å®šé«˜åº¦ */
    }

    #copy-link img { 
      width:100%;  /* è¨­å®šåœ–ç‰‡å¯¬åº¦ç‚º100% */
      height:100%;  /* è¨­å®šåœ–ç‰‡é«˜åº¦ç‚º100% */
      object-fit:cover;  /* è¨­å®šåœ–ç‰‡è¦†è“‹é¡¯ç¤º */
    }

    #copied-msg { 
      position:absolute;  /* è¨­å®šç‚ºçµ•å°å®šä½ */
      top:120%;  /* è¨­å®šä½ç½®è·é›¢ä¸Šæ–¹120% */
      font-size:.9rem;  /* è¨­å®šå­—é«”å¤§å° */
      color:#28a745;  /* è¨­å®šé¡è‰²ç‚ºç¶ è‰² */
      display:none;  /* è¨­å®šç‚ºéš±è— */
      margin-top:5px;  /* è¨­å®šä¸Šæ–¹é–“è· */
    }

    /* ====== æ–‡ç« çµ±è¨ˆæ¨£å¼ ====== */
    .stats { 
      display:flex;  /* è¨­å®šç‚ºå½ˆæ€§å®¹å™¨ */
      justify-content:space-between;  /* è®“é …ç›®å…©ç«¯å°é½Š */
      align-items:center;  /* è¨­å®šé …ç›®å‚ç›´å±…ä¸­ */
      margin-top:1rem;  /* è¨­å®šä¸Šæ–¹é–“è· */
      padding-left:15px;  /* è¨­å®šå·¦å´å…§é‚Šè· */
      padding-right:15px;  /* è¨­å®šå³å´å…§é‚Šè· */
      width:calc(100% - 30px);  /* è¨­å®šå¯¬åº¦ï¼Œæ¸›å»å…§é‚Šè· */
      margin-left:auto;  /* è¨­å®šè‡ªå‹•å¤–é‚Šè·ï¼Œå±…ä¸­å°é½Š */
      margin-right:auto;  /* è¨­å®šè‡ªå‹•å¤–é‚Šè·ï¼Œå±…ä¸­å°é½Š */
    }

    /* ====== æ„›å¿ƒæŒ‰éˆ•æ¨£å¼ ====== */
    .like-btn { 
      background:none;  /* è¨­å®šèƒŒæ™¯ç‚ºé€æ˜ */
      border:none;  /* ç§»é™¤é‚Šæ¡† */
      font-size:1.2rem;  /* è¨­å®šå­—é«”å¤§å°ç‚º1.2rem */
      color:red;  /* è¨­å®šæ–‡å­—é¡è‰²ç‚ºç´…è‰² */
      cursor:pointer;  /* è¨­å®šæ»‘é¼ æ¨£å¼ç‚ºæŒ‡æ¨™ */
      display:flex;  /* è¨­å®šç‚ºå½ˆæ€§å®¹å™¨ */
      align-items:center;  /* è¨­å®šé …ç›®å‚ç›´å±…ä¸­ */
    }

    .like-btn:hover { color:#e04848; }  /* è¨­å®šæ»‘é¼ æ‡¸åœæ™‚é¡è‰²æ”¹ç‚ºæ·±ç´…è‰² */
    .like-btn span { margin-left:5px; }  /* è¨­å®šæ„›å¿ƒå’Œæ•¸å­—ä¹‹é–“çš„é–“è· */
    .like-btn.is-liked { 
      opacity:.6;  /* è¨­å®šå·²æŒ‰è®šæ™‚çš„é€æ˜åº¦ç‚º0.6 */
      cursor:default;  /* è¨­å®šæ»‘é¼ æ¨£å¼ç‚ºé»˜èª */
      pointer-events:none;  /* ç¦æ­¢é»æ“Šäº‹ä»¶ */
    }
  </style>
</head>
<body>
  <header><h1>æ¯›è¶Šå¯ºçš„æ¥“æ¨¹</h1></header>

  <main>
    <div class="date">2023å¹´11æœˆ19æ—¥</div>

    <img src="images/æ¥“æ¨¹.jpg" alt="ï½œæ¯›è¶Šå¯ºçš„æ¥“æ¨¹ï½œ">
    <p>å¾ˆå–œæ­¡é€™é¡†æœªå…¨éƒ¨è¦‹å‚¾çš„æ¥“æ¨¹ã€‚</p>
    <p>å…‰å½±å¾è‘‰å­ä¸Šé ­æ‰“ä¸‹ä¾†ï¼Œæˆ–ç©¿é€æˆ–ç”¢ç”Ÿæš—éƒ¨é™°å½±çš„æ•ˆæœï¼ŒåŠ ä¸Šæ¥“è‘‰åŸå…ˆæ¼¸å±¤çš„è‰²å½©ä»¤äººè‘—è¿·ã€‚</p>
    <p>é‚£å¤©æ°£æº«å…«åº¦å·¦å³ï¼Œæˆ‘å€‘ç„¡ç•å¯’å†·åœ°åœ¨æ¯›è¶Šå¯ºç‹‚æŒ‰å¿«é–€ï¼Œç›´åˆ°é›™æ‰‹å†ä¹Ÿå¿å—ä¸äº†å¯’é¢¨è€Œå‡åƒµæ‰æ”¶èµ·ç›¸æ©ŸğŸ“·ï¼Œåˆ°é™„è¿‘çš„è•éº¥éºµåº—å–æš–æœè…¹ã€‚</p>
    

    <a class="back-link" href="index.html">â† å›åˆ°é¦–é </a>

    <!-- åˆ†äº«åŠŸèƒ½ -->
    <div class="share-section">
      <div class="line"></div>
      <div class="share-icons">
        <a class="icon facebook-icon" id="fb-share" href="#" target="_blank" rel="noopener noreferrer" title="åˆ†äº«åˆ° Facebook">f</a>
        <button class="icon" id="copy-link" title="è¤‡è£½é€£çµ">
          <img src="images/share.jpg" alt="è¤‡è£½é€£çµ">
        </button>
        <span id="copied-msg">Link Copied!</span>
      </div>
      <div class="line"></div>
    </div>

    <!-- è§€çœ‹èˆ‡æŒ‰è®š -->
    <div class="stats">
      <div class="view"><span id="post-views">0</span> views</div>
      <div class="like">
        <button class="like-btn" id="post-like-btn">â™¡ <span id="post-likes">0</span></button>
      </div>
    </div>
  </main>

  <!-- å…ˆè¼‰å…¥å…±ç”¨ API è¨­å®šï¼ˆä¸€å®šè¦æ”¾åœ¨ç”¨åˆ° API_URL çš„è…³æœ¬ä¹‹å‰ï¼‰ -->
  <script src="/api.js?v=1"></script>

  <!-- å–®ä¸€è…³æœ¬ï¼šaddView + è®€å–æœ€æ–°æ•¸å­— + æ„›å¿ƒ -->
  <script>
    // å¾ api.js å–å¾—å…±ç”¨ URL
    const API_URL = window.API_URL;

    // â€”â€” å…±ç”¨å·¥å…·ï¼ˆGET å‘¼å«ï¼Œé¿å…é æª¢ï¼‰â€”â€”
    async function api(params){
      const url = API_URL + '?' + new URLSearchParams(params).toString();
      const r = await fetch(url, { cache:'no-store' });
      return r.json();
    }
    const getStats = (id) => api({ action:'get', id });
    const addView  = (id) => api({ action:'addView', id });
    const likeAPI  = (id) => api({ action:'like', id });

    // é€™ç¯‡æ–‡ç« çš„ idï¼ˆç”¨æª”åï¼‰
    const POST_ID = decodeURIComponent(location.pathname.split('/').pop() || 'index.html');

    // æœ¬æ©Ÿ liked mapï¼ˆå’Œé¦–é å…±ç”¨ï¼‰
    const LIKE_KEY = 'blog_liked_map';
    function loadLiked(){ try { return JSON.parse(localStorage.getItem(LIKE_KEY) || '{}'); } catch { return {}; } }
    function saveLiked(m){ localStorage.setItem(LIKE_KEY, JSON.stringify(m)); }
    function isLiked(id){ return !!loadLiked()[id]; }
    function setLiked(id,v){ const m = loadLiked(); m[id] = !!v; saveLiked(m); }

    // æ¸²æŸ“æ„›å¿ƒ
    function renderHeart(btnEl, id, likeCount, likesSpanId){
      const liked = isLiked(id);
      btnEl.innerHTML = `${liked ? 'â¤ï¸' : 'â™¡'} <span id="${likesSpanId}">${likeCount ?? 0}</span>`;
      btnEl.classList.toggle('is-liked', liked);
      btnEl.disabled = liked;
    }

    // åˆ†äº«æŒ‰éˆ•
    (function setupShare(){
      const fbA = document.getElementById('fb-share');
      if (fbA) fbA.href = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(location.href);
      const copyBtn = document.getElementById('copy-link');
      if (copyBtn){
        copyBtn.addEventListener('click', () => {
          navigator.clipboard.writeText(location.href).then(()=>{ 
            const msg = document.getElementById('copied-msg');
            if (!msg) return;
            msg.style.display = 'inline';
            setTimeout(()=>{ msg.style.display = 'none'; }, 2000);
          });
        });
      }
    })();

    // ä¸»æµç¨‹ï¼šé–‹é  +1ã€è®€æ•¸å­—ã€ç¶æ„›å¿ƒ
    (async () => {
      // é€²é  +1ï¼ˆå³ä½¿å¤±æ•—ä¹Ÿä¸æ“‹å¾ŒçºŒï¼‰
      try { await addView(POST_ID); } catch(e){ console.warn('addView fail', e); }

      // æŠ“æœ€æ–°æ•¸å­—
      let views = 0, likes = 0;
      try {
        const s = await getStats(POST_ID);
        views = (s && s.ok && s.views != null) ? s.views : 0;
        likes = (s && s.ok && s.likes != null) ? s.likes : 0;
      } catch(e) {
        console.warn('getStats fail', e);
      }

      // ç•«åˆ°é é¢
      const viewEl  = document.getElementById('post-views');
      const likesEl = document.getElementById('post-likes');
      const btn     = document.getElementById('post-like-btn');
      if (viewEl)  viewEl.textContent = views;
      if (likesEl) likesEl.textContent = likes;
      if (btn)     renderHeart(btn, POST_ID, likes, 'post-likes');

      // ç¶å®šæ„›å¿ƒï¼ˆåŒä¸€ä½¿ç”¨è€…ä¸å¯é‡è¤‡æŒ‰ï¼‰
      if (btn){
        btn.addEventListener('click', async (e) => {
          e.preventDefault();
          if (isLiked(POST_ID)) return;

          let curLikes = parseInt(document.getElementById('post-likes')?.textContent || '0', 10);
          renderHeart(btn, POST_ID, curLikes + 1, 'post-likes'); // æ¨‚è§€ +1

          try{
            const res = await likeAPI(POST_ID);
            if (res && res.ok){
              setLiked(POST_ID, true);
              renderHeart(btn, POST_ID, res.likes ?? (curLikes + 1), 'post-likes');
            }else{
              renderHeart(btn, POST_ID, curLikes, 'post-likes'); // å¾©åŸ
              alert('æŒ‰è®šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
            }
          }catch(err){
            renderHeart(btn, POST_ID, curLikes, 'post-likes'); // å¾©åŸ
            alert('æŒ‰è®šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
          }
        });
      }
    })();

    // è·¨åˆ†é åŒæ­¥æ„›å¿ƒå¤–è§€
    window.addEventListener('storage', (e) => {
      if (e.key !== LIKE_KEY) return;
      const btn = document.getElementById('post-like-btn');
      const likesSpan = document.getElementById('post-likes');
      if (btn && likesSpan){
        const curLikes = parseInt(likesSpan.textContent || '0', 10);
        renderHeart(btn, POST_ID, curLikes, 'post-likes');
      }
    });
  </script>
</body>
</html>

