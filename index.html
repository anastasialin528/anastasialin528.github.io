<!DOCTYPE html> <!-- HTML5 文件宣告 -->
<html lang="zh-Hant"> <!-- 頁面語系：繁體中文 -->
<head> <!-- 文件頭開始 -->
  <meta charset="UTF-8"> <!-- 編碼 UTF-8，避免亂碼 -->
  <meta name="viewport" content="width=device-width,initial-scale=1"> <!-- RWD 視窗設定 -->
  <title>Anastasia</title> <!-- 瀏覽器分頁標題 -->

  <style> /* ====== 全站基本樣式 ====== */
    body{margin:0; font-family:"Microsoft JhengHei",sans-serif; background:#f9f9f6; color:#333} /* 文字色 */
    header{position:fixed; top:0;left:0;width:100%; background:#212121; padding:1rem 2rem; color:#fff; display:flex;align-items:center;justify-content:space-between;} 
    header h1{margin:0; font-size:2rem; color:#fff;} /* 標題大小 */
    nav{display:flex; gap:1.5rem;} 
    nav a{color:#fff; text-decoration:none; font-weight:bold; white-space:nowrap;} 
    nav a:hover{text-decoration:underline;} 
    .hero-gallery{display:grid; grid-template-columns:repeat(auto-fit,minmax(100%,1fr)); grid-auto-rows:50vh; width:100vw; margin-top:64px;} 
    .hero-gallery img{width:100%;height:100%; object-fit:cover; display:block;} 
    .hero-title{text-align:center; padding:2rem 1rem; font-size:3rem; color:#6fb1a0; font-weight:bold; font-family:'Segoe Script',cursive;}
    .content-wrapper{background:#f9f9f6; padding:2rem 1rem; display:flex;justify-content:center;} 
    main{max-width:1000px; width:100%;} 
    .tags{text-align:center; margin-bottom:2rem;} 
    .tags button{background:#fff; border:2px solid #6fb1a0; color:#6fb1a0; padding:.5rem 1.2rem; margin:.4rem; border-radius:25px; cursor:pointer; font-size:1rem;} 
    .tags button:hover{background:#6fb1a0;color:#fff;} 
    .posts{column-count:3; column-gap:1.5rem;} 
    @media (max-width:1024px){.posts{column-count:2}} 
    @media (max-width:600px){.posts{column-count:1}} 
    .card{background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,.1); text-decoration:none; color:inherit; transition:transform .3s ease; display:inline-block; width:100%; margin-bottom:1.5rem; break-inside:avoid; position:relative;} 
    .card:hover{transform:translateY(-5px);} 
    .card img{width:100%;height:320px; object-fit:cover; display:block;} 
    .card-content{padding:1rem;} 
    .card-content h2{margin:0 0 .5rem; color:#6fb1a0; font-size:1.4rem;} 
    .card-content .date{font-size:.9rem; color:#999; margin-bottom:.5rem;} 
    .card-content p{margin:0; line-height:1.6; color:#555;} 
    .card-meta{border-top:1px solid #ccc; margin-top:1rem; padding-top:.8rem; padding-left:.5rem;padding-right:.5rem; display:flex;justify-content:space-between;align-items:center; font-size:.9rem;color:#999;} 
    .like-btn{background:none; border:none; color:red; cursor:pointer; font-size:1rem; display:flex;align-items:center;} 
    .like-btn span{margin-left:5px;} 
    .like-btn.is-liked{opacity:.6;cursor:default;pointer-events:none;} 
    .site-footer{background:#f1f0ed; padding:3rem 1rem;} 
    .footer-inner{max-width:1000px; margin:0 auto; position:relative;} 
    .footer-social{display:flex; gap:3rem; justify-content:flex-end; margin-bottom:1.25rem; font-style:italic;} 
    .footer-social a{color:#133d33; text-decoration:none;} 
    .footer-social a:hover{text-decoration:underline;} 
    .footer-line{height:2px;background:#133d33;border:none;width:100%;margin:1rem auto 1.25rem;} 
    .footer-copy{text-align:center;font-size:.9rem;color:#6b7b74;} 
    @media (max-width:768px){.footer-social{justify-content:center;gap:2rem}} 
  </style> <!-- 樣式結束 --> 
</head> <!-- 文件頭結束 -->

<body> <!-- 主體開始 -->
  <header> <!-- 固定導覽列 -->
    <h1>dEaR dIaRy</h1> <!-- 網站標題 -->
    <nav> <!-- 主選單 -->
      <a href="index.html">MAIN PAGE</a> <!-- 回首頁 -->
      <a href="about.html">ABOUT ME</a> <!-- 關於我 -->
      <a href="contact.html">CONTACT</a> <!-- 聯絡我 -->
    </nav>
  </header> 

  <div class="hero-gallery"> 
    <img src="images/DSC0E8628.jpg" alt="Hero image" loading="lazy"> 
  </div> 
  <div class="hero-title">Beautiful Little Things</div> 

  <div class="content-wrapper">
    <main>
      <div class="tags" aria-label="文章分類篩選">
        <button type="button" onclick="filterTag('all')">全部</button> 
        <button type="button" onclick="filterTag('旅遊')">旅遊</button> 
        <button type="button" onclick="filterTag('星空')">星空</button> 
        <button type="button" onclick="filterTag('日常')">日常</button> 
        <button type="button" onclick="filterTag('潛水')">潛水</button>
      </div>

      <div class="posts" id="postList">
        <!-- 在這裡列出所有文章卡片 -->
        <a href="2023年6月25日.html" class="card">
          <img src="images/九份.jpg" alt="｜九份｜">
          <div class="card-content">
            <h2>｜九份｜</h2>
            <div class="date">2023年6月25日</div>
            <p>收假前一衝💃🕺🏻/依山傍海超強外景⛰️🏖️</p>
            <div class="card-meta">
              <span id="views-0">0 views</span>
              <button class="like-btn" type="button" id="like-btn-0">
                ♡ <span id="likes-0">0</span>
              </button>
            </div>
          </div>
        </a>
        <a href="2023年7月2日.html" class="card">
          <img src="images/BLUE.jpg" alt="｜台中老家三日遊｜">
          <div class="card-content">
            <h2>｜台中老家三日遊｜</h2>
            <div class="date">2023年7月2日</div>
            <p>LaLaport踩點尋找龍貓好朋友：龍貓BLUE/遲來的一大堆生日禮物🎁裝滿一卡皮箱🧳</p>
            <div class="card-meta">
              <span id="views-1">0 views</span>
              <button class="like-btn" type="button" id="like-btn-1">
                ♡ <span id="likes-1">0</span>
              </button>
            </div>
          </div>
        </a>
        <a href="2023年9月29日.html" class="card">
          <img src="images/林口海邊夕陽.jpg" alt="｜林口海邊｜">
          <div class="card-content">
            <h2>｜林口海邊｜</h2>
            <div class="date">2023年9月29日</div>
            <p>放鬆的海岸線/鹹鹹的海風/懷念的阿Q桶麵/美味的抹茶冰淇淋</p>
            <div class="card-meta">
              <span id="views-2">0 views</span>
              <button class="like-btn" type="button" id="like-btn-2">
                ♡ <span id="likes-2">0</span>
              </button>
            </div>
          </div>
        </a>
        <a href="2023年11月16日.html" class="card">
          <img src="images/DSC0E8692.jpg" alt="｜弘前城公園｜">
          <div class="card-content">
            <h2>｜弘前城公園｜</h2>
            <div class="date">2023年11月16日</div>
            <p>旅程最後一天，為了在前往仙台機場前抓緊時間前往弘前城...</p>
            <div class="card-meta">
              <span id="views-3">0 views</span>
              <button class="like-btn" type="button" id="like-btn-3">
                ♡ <span id="likes-3">0</span>
              </button>
            </div>
          </div>
        </a>
        <a href="2023年11月18日.html" class="card">
          <img src="images/街貓.jpg" alt="｜街貓｜">
          <div class="card-content">
            <h2>｜街貓｜</h2>
            <div class="date">2023年11月18日</div>
            <p>好幸運，今天遇見住在柿園裡的小貓。更幸運的是能有機會迅速拍下牠可愛的背影。</p>
            <div class="card-meta">
              <span id="views-4">0 views</span>
              <button class="like-btn" type="button" id="like-btn-4">
                ♡ <span id="likes-4">0</span>
              </button>
            </div>
          </div>
        </a>
        <!-- 這裡可以繼續添加更多文章卡片 -->
      </div>
    </main>
  </div>

  <footer class="site-footer">
    <div class="footer-inner">
      <nav class="footer-social" aria-label="Social links">
        <a href="https://www.facebook.com/anastasialin528" target="_blank" rel="noopener">Facebook</a>
        <a href="https://www.instagram.com/anastasialin528/" target="_blank" rel="noopener">Instagram</a>
        <a href="https://www.pinterest.com/" target="_blank" rel="noopener">Pinterest</a>
        <a href="https://www.youtube.com/" target="_blank" rel="noopener">Youtube</a>
        <a href="https://chatgpt.com/" target="_blank" rel="noopener">ChatGPT</a>
      </nav>
      <hr class="footer-line">
      <div class="footer-copy">© 2025 我的日記部落格</div>
    </div>
  </footer>

  <script>
    const API_URL = window.API_URL; // 從 /api.js 取得共用 GAS /exec URL
    if (!API_URL) console.error('找不到 window.API_URL，請確認已正確部署 /api.js'); 

    const postList = document.getElementById("postList"); 

    function syncAllHearts(){ 
      posts.forEach((post, index) => { 
        const id = idFromHref(post.href); 
        const btn = document.getElementById(`like-btn-${index}`); 
        const likesSpan = document.getElementById(`likes-${index}`); 
        if (btn && likesSpan) {
          const currentLikes = parseInt(likesSpan.textContent || '0', 10); 
          renderHeart(btn, id, currentLikes, `likes-${index}`); 
        } 
      }); 
    }

    const ids = [];
    posts.forEach((post, index) => {
      const id = idFromHref(post.href); 
      ids.push(id); 
      
      const card = document.createElement("a"); 
      card.href = post.href; 
      card.className = "card"; 
      card.setAttribute("data-tag", post.tag); 
      card.innerHTML = `
        <img src="${post.img}" alt="${post.title}" loading="lazy">
        <div class="card-content">
          <h2>${post.title}</h2>
          <div class="date">${post.date}</div>
          <p>${post.excerpt}</p>
          <div class="card-meta">
            <span id="views-${index}">0 views</span>
            <button class="like-btn" type="button" id="like-btn-${index}">
              ${isLiked(id) ? '❤️' : '♡'} <span id="likes-${index}">0</span>
            </button>
          </div>
        </div>
      `;
      postList.appendChild(card); 

      document.getElementById(`like-btn-${index}`).addEventListener('click', async (e) => { 
        e.preventDefault(); e.stopPropagation();
        if (isLiked(id)) return;

        const btn = e.currentTarget; 
        const likesSpan = document.getElementById(`likes-${index}`);
        let curLikes = parseInt(likesSpan.textContent || '0', 10); 
        renderHeart(btn, id, curLikes + 1, `likes-${index}`);

        const res = await likeAPI(id); 
        if (res && res.ok) { 
          setLiked(id, true); 
          const newLikes = (res.data && res.data.likes != null) ? res.data.likes : 
                           (res.likes != null ? res.likes : (curLikes + 1)); 
          renderHeart(btn, id, newLikes, `likes-${index}`); 
        } else { 
          renderHeart(btn, id, curLikes, `likes-${index}`); 
          alert('按讚失敗，請稍後再試。');
        }
      });
    });

    (async () => {
      try {
        const r = await apiPost({ action:'get', ids });
        if (r && r.ok && r.data) { 
          posts.forEach((post, index) => { 
            const id = idFromHref(post.href); 
            const datum = r.data[id] || {}; 
            const v = document.getElementById(`views-${index}`);
            const btn = document.getElementById(`like-btn-${index}`);
            const likeCount = (datum.likes ?? 0); 
            if (v) v.textContent = `${(datum.views ?? 0)} views`; 
            if (btn) renderHeart(btn, id, likeCount, `likes-${index}`); 
          });
        } else { 
          posts.forEach((post, index) => { 
            const id = idFromHref(post.href); 
            const btn = document.getElementById(`like-btn-${index}`); 
            if (btn) renderHeart(btn, id, 0, `likes-${index}`); 
          });
        }
      } catch (err) { 
        console.error('批次取數失敗：', err); 
      }
    })(); 

    function filterTag(tag){
      const cards = document.querySelectorAll('.card'); 
      cards.forEach(card => {
        card.style.display = (tag==='all' || card.dataset.tag===tag) ? 'inline-block' : 'none';
      });
    }
  </script>
</body>
</html>
